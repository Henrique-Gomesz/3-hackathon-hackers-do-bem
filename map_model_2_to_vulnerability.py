from db import vulnerabilities_collection, modelo2
from db import modelo2
from vulnerability import Vulnerability

def map_model_2_to_vulnerability():
    cursor = modelo2.find({})

    for doc in cursor:
        vulnerability: Vulnerability = Vulnerability(
            name = doc.get("definition").get("name"),
            description = doc.get("definition").get("description"),
            companyCriticality = int(doc.get("asset").get("criticality")),
            date = doc.get("definition").get("name"),
            cve_id = doc.get("cve", [None])[0] if isinstance(doc.get("cve"), list) else None,
            environments = doc.get("asset").get("tags"),
            epss = doc.get("definition").get("epss_score"),
            family = doc.get("definition").get("family")
        )

        vulnerabilities_collection.insert_one(vulnerability)
